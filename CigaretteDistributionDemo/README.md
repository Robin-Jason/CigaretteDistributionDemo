# 卷烟投放管理系统

## 项目简介

这是一个基于Vue 3 + Element Plus的卷烟投放管理系统，用于管理卷烟的档位分配和投放策略。

## 主要功能

### 1. 卷烟投放数据查询
- 支持按年份、月份、周序号查询卷烟分配数据
- 显示30个档位的分配值（D30~D1）
- 支持投放区域、投放方式等信息的展示
- 自动合并相同分配方案的记录
- 选中记录时在中间表单显示预投放量和实际投放量 
- 查询到单条记录时自动选中并显示投放量信息

### 2. 档位设置管理
- 可视化档位设置界面（6行5列布局）
- 支持单个档位数值修改
- 批量设置功能（全部档位、前15档、后15档、自定义范围）
- 实时预览档位分配效果

### 3. 卷烟信息更新
- 支持更新卷烟的完整信息
- 包括投放方式、扩展投放方式、投放区域等
- 档位分配数据的实时更新
- 与后端API的完整集成

### 4. Excel数据导出 
- **卷烟投放数据导出**: 支持完整的数据表导出，包含30个档位分配值
- **档位设置导出**: 支持单个卷烟的档位设置数据导出
- **专业格式**: Excel 2007+ (.xlsx)格式，支持样式设置和列宽配置
- **智能命名**: 自动生成带时间戳的文件名
- **查询信息**: 包含查询条件和导出说明的工作表

## 技术架构

### 前端技术栈
- **Vue 3**: 使用Composition API和响应式系统
- **Element Plus**: UI组件库，提供美观的界面组件
- **Axios**: HTTP客户端，用于API调用
- **Vue Router**: 前端路由管理
- **XLSX**: Excel文件生成库，支持.xlsx格式
- **File-Saver**: 文件下载库，支持浏览器文件保存

### 后端接口
- **基础URL**: `http://localhost:28080/api/cigarette`
- **主要接口**:
  - `POST /query`: 查询卷烟分配数据
  - `POST /update-cigarette`: 更新卷烟信息（推荐）
  - `GET /health`: 健康检查

## 安装和运行

### 环境要求
- Node.js >= 14.0.0
- npm >= 6.0.0

### 安装依赖
```bash
npm install
```

### 启动开发服务器
```bash
npm run serve
```

### 构建生产版本
```bash
npm run build
```

## 使用说明

### 1. 查询数据
1. 在搜索表单中选择年份、月份、周序号
2. 点击"查询"按钮获取数据
3. 系统会自动调用后端API并显示结果

### 2. 查看数据
1. 查询结果会在数据表格中显示
2. 日期列显示格式化的时间信息
3. 档位列显示各档位的投放数量
4. 点击表格行选中记录，中间表单会显示该卷烟的详细信息

### 3. 查看卷烟详情
1. 在数据表格中点击选择一条卷烟记录
2. 中间表单会自动显示该卷烟的投放量信息
3. 包括：卷烟代码、卷烟名称、预投放量、实际投放量
4. 档位设置区域会同步加载该卷烟的档位数据
5. 查询到单条记录时会自动选中并显示投放量信息

### 4. 修改档位
1. 在数据表格中点击选择一条卷烟记录
2. 在档位设置区域修改相应的档位数值
3. 点击"保存全部"按钮提交更改

### 5. 数据导出
1. 设置查询条件
2. 点击"导出Excel"按钮
3. 系统自动生成Excel文件并下载

### 6. Excel导出功能详解

#### 卷烟投放数据导出
- **导出位置**: 数据表格右上角的"导出Excel"按钮
- **导出内容**: 包含所有查询结果的完整数据表
- **文件格式**: Excel 2007+ (.xlsx)
- **文件命名**: `卷烟投放数据统计表_YYYY-MM-DDTHH-MM-SS.xlsx`
- **工作表**: 
  - 主表：卷烟投放数据（包含30个档位列）
  - 信息表：查询条件和导出说明

#### 档位设置导出
- **导出位置**: 档位设置区域右上角的"导出Excel"按钮
- **导出内容**: 当前选中卷烟的档位设置数据
- **文件格式**: Excel 2007+ (.xlsx)
- **文件命名**: `档位设置_卷烟名称_YYYY-MM-DDTHH-MM-SS.xlsx`
- **数据格式**: 档位编号 + 分配值的两列表格

#### Excel文件特性
- **样式设置**: 表头粗体、居中对齐、蓝色背景
- **列宽配置**: 智能列宽设置，确保数据完整显示
- **边框样式**: 所有单元格都有细边框
- **中文支持**: 完整的中文文件名和列名支持

## 项目结构

```
src/
├── components/          # 组件目录
│   ├── DataTable.vue   # 数据表格组件
│   ├── SearchForm.vue  # 搜索表单组件
│   └── PositionSetting.vue # 档位设置组件
├── services/            # 服务目录
│   └── api.js         # API接口服务
├── utils/              # 工具目录
│   └── excelExport.js # Excel导出工具类
├── views/              # 页面视图
│   └── Home.vue       # 主页面
└── main.js            # 应用入口
```

## 开发说明

### 组件通信
- 使用Props和Events进行父子组件通信
- 通过Vuex或事件总线管理复杂状态（如需要）

### API集成
- 所有API调用都通过`services/api.js`统一管理
- 支持请求/响应拦截器
- 统一的错误处理机制

### 样式设计
- 使用Element Plus的设计规范
- 响应式布局，支持不同屏幕尺寸
- 档位网格采用CSS Grid布局

## 注意事项

1. **后端服务**: 确保后端服务在`localhost:28080`端口运行
2. **数据格式**: 档位数据使用D30~D1的命名规范
3. **网络请求**: 开发环境使用代理配置避免跨域问题
4. **数据更新**: 修改档位后需要点击保存按钮才能提交到后端

## 更新日志

### v1.0.0 (2024-01-XX)
- 初始版本发布
- 实现基本的卷烟查询和档位设置功能
- 集成后端API接口
- 支持30个档位的可视化设置
