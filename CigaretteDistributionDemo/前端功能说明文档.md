# 卷烟投放管理系统前端功能说明文档

## 📋 项目概述

卷烟投放管理系统是一个基于Vue 3 + Element Plus的现代化Web应用，专门用于管理卷烟档位分配和投放策略。系统提供直观的界面操作，支持数据查询、档位设置、Excel导入导出等功能。

### 基本信息
- **技术栈**: Vue 3 + Element Plus + Axios + XLSX
- **开发模式**: SPA (单页应用)
- **数据格式**: JSON
- **支持的档位**: 30档 (D30~D1)
- **后端接口**: RESTful API

---

## 🏗️ 系统架构

### 组件结构
```
src/
├── components/                 # 组件目录
│   ├── DataTable.vue          # 数据表格组件 - 数据展示和选择
│   └── SearchForm.vue         # 搜索表单组件 - 查询条件和档位设置
├── views/
│   └── Home.vue               # 主页面 - 整体布局和数据导入
├── services/
│   └── api.js                 # API接口服务 - 后端通信
└── utils/
    └── excelExport.js         # Excel导出工具 - 数据导出处理
```

### 数据流向
```
用户输入 → SearchForm → Home → DataTable → API服务 → 后端
         ↑                                           ↓
         ← 组件通信 ← 数据更新 ← 响应处理 ← HTTP响应 ←
```

---

## 🔍 核心功能详解

### 1. 数据查询与展示

#### 1.1 查询条件设置
**位置**: SearchForm组件顶部  
**功能**: 设置查询的时间范围和过滤条件

**支持的查询条件**:
- **年份选择**: 当前年份前后各2年范围 (2022-2027)
- **月份选择**: 1-12月完整月份范围
- **周序号输入**: 1-5周的数字输入
- **卷烟名称搜索**: 支持模糊匹配查找
- **投放类型筛选**: 
  - 按档位统一投放
  - 按档位扩展投放
- **扩展投放类型** (扩展投放时显示):
  - 档位+区县
  - 档位+城乡分类代码
  - 档位+市场类型
  - 档位+业态
- **投放区域多选**: 根据投放类型动态显示可选区域

**智能特性**:
- 必填字段验证：年份、月份、周序号为必填
- 关联字段联动：投放类型影响区域选项
- 卷烟名称联想：输入时自动匹配表格数据
- 日期完整性检查：确保查询条件完整

#### 1.2 数据表格展示
**位置**: DataTable组件  
**功能**: 展示查询结果和支持数据交互

**表格列结构**:
- **基础信息列**:
  - 卷烟代码 (100px)
  - 卷烟名称 (180px)  
  - 日期显示 (150px) - 格式：××年××月第×周
  - 投放区域 (200px)
- **档位数据列**: 30列档位数据 (D30~D1，每列50px)
- **备注信息列**: 可变宽度备注信息

**显示特性**:
- **数据分组**: 同一卷烟同一日期的记录集中排列
- **行高亮**: 选中卷烟的所有相关记录统一高亮
- **数值颜色**: 档位值按大小显示不同颜色
  - 高值 (>30): 橙色粗体
  - 中值 (10-30): 蓝色
  - 低值 (<10): 灰色
- **空数据处理**: 显示友好的空状态提示

**交互功能**:
- **行选择**: 点击行选中该卷烟的所有记录
- **自动滚动**: 选中时自动滚动到记录位置
- **数据刷新**: 支持手动刷新按钮
- **实时更新**: 档位修改后自动刷新显示

### 2. 档位设置管理

#### 2.1 档位网格界面
**位置**: SearchForm组件下方档位设置区域  
**布局**: 6列网格布局，共30个档位输入框

**界面特点**:
- **清晰标识**: 每个档位显示"D30"、"D29"...标签
- **输入控制**: 数字输入框，最小值0，整数精度
- **即时反馈**: 修改时实时验证数值有效性
- **视觉层次**: 档位标签使用蓝色突出显示

#### 2.2 档位操作功能
**提供的操作按钮**:

1. **保存档位设置**
   - 验证数据有效性 (至少设置一个档位值)
   - 发送更新请求到后端
   - 成功后刷新表格数据

2. **重置档位**
   - 恢复到当前选中记录的原始档位数据
   - 清空所有修改内容

3. **新增投放区域**
   - 基于当前档位设置创建新区域记录
   - 支持批量选择多个区域
   - 确认对话框防止误操作

4. **删除投放区域**
   - 多选删除不需要的投放区域
   - 保护性检查：至少保留一个区域
   - 删除前确认对话框

#### 2.3 数据验证机制
- **基础验证**: 档位值必须为非负整数
- **业务验证**: 至少设置一个档位值大于0
- **保护性验证**: 删除区域时确保至少保留一个

### 3. 数据导入功能

#### 3.1 卷烟投放基本信息导入
**触发位置**: 主页面顶部"导入卷烟投放基本信息"按钮  
**对话框功能**:

**时间参数设置**:
- 年份选择下拉框
- 月份选择下拉框 (1-12月)
- 周序号选择下拉框 (1-5周)

**文件上传控制**:
- 支持格式: `.xlsx`, `.xls`
- 文件大小限制: 10MB
- 单文件上传限制
- 文件格式自动验证

**导入流程**:
1. 选择完整的时间参数
2. 上传Excel文件
3. 系统验证文件和参数
4. 后端处理并返回导入结果
5. 显示导入成功的记录数量
6. 自动刷新表格数据

#### 3.2 区域客户数导入
**触发位置**: 主页面顶部"导入区域客户数"按钮  
**对话框功能**:

**投放类型配置**:
- 投放类型选择: 统一投放/扩展投放
- 扩展类型选择 (扩展投放时):
  - 档位+区县
  - 档位+城乡分类代码  
  - 档位+市场类型
  - 档位+业态

**文件处理**:
- 同样的Excel格式和大小限制
- 根据投放类型映射序列号
- 自动生成年月参数

### 4. 一键执行分配方案生成

#### 4.1 智能方案生成
**触发位置**: 主页面顶部"生成分配方案"按钮  
**功能描述**: 基于导入的基本信息和客户数据自动生成档位分配

**生成流程**:
1. **时间参数选择**: 选择需要生成方案的年月周
2. **数据准备检查**: 确认已导入基本信息和客户数据
3. **算法执行**: 后端运行分配算法
4. **结果统计**: 显示详细的生成统计信息
5. **数据更新**: 自动刷新表格显示最新方案

**统计信息展示**:
- 📊 处理卷烟种类数量
- ✅ 成功分配卷烟数量
- 🗑️ 删除旧记录数量
- 📝 生成新记录数量
- ⏱️ 处理耗时信息

#### 4.2 结果展示
**弹窗显示**: 详细的统计信息美观弹窗  
**自动刷新**: 完成后自动查询并显示生成的数据  
**时间同步**: 使用生成时的时间参数自动更新查询条件

### 5. Excel数据导出

#### 5.1 卷烟投放数据导出
**触发位置**: 数据表格右上角"导出Excel"按钮  
**导出内容**: 当前查询结果的完整数据表

**文件特性**:
- **文件格式**: Excel 2007+ (.xlsx)
- **文件命名**: `卷烟投放数据统计表_YYYY-MM-DDTHH-MM-SS.xlsx`
- **工作表结构**:
  - 主表: 完整的卷烟投放数据 (包含30个档位列)
  - 信息表: 查询条件和导出说明

**数据处理**:
- 包含所有查询结果记录
- 保持表格中的列结构
- 30个档位完整导出
- 中文列名和内容支持

#### 5.2 档位设置导出
**触发位置**: 档位设置区域"导出Excel"按钮  
**导出内容**: 当前选中卷烟的档位设置

**文件特性**:
- **文件命名**: `档位设置_卷烟名称_YYYY-MM-DDTHH-MM-SS.xlsx`
- **数据格式**: 档位编号 + 分配值两列表格
- **数据范围**: D30到D1完整档位数据

#### 5.3 Excel格式优化
**样式配置**:
- 表头: 粗体、居中对齐、蓝色背景
- 边框: 所有单元格细边框
- 列宽: 智能宽度适配数据长度
- 字体: 中文友好字体配置

### 6. 投放区域管理

#### 6.1 区域数据结构
**区域选项配置**:
```javascript
按档位统一投放: ['全市']
档位+区县: ['丹江', '房县', '郧西', '郧阳', '竹山', '竹溪', '城区']
档位+城乡分类代码: ['主城区', '城乡结合区', '镇中心区', '镇乡结合区', '特殊区域', '乡中心区', '村庄']
档位+市场类型: ['城网', '农网']  
档位+业态: ['便利店', '超市', '商场', '烟草专卖店', '娱乐服务类', '其他']
```

#### 6.2 新增投放区域
**操作流程**:
1. 在投放区域多选框中选择新区域
2. 确保档位数据已设置
3. 点击"新增投放区域"按钮
4. 系统确认对话框显示新增区域列表
5. 确认后为每个新区域创建记录
6. 使用当前档位设置作为新区域的分配数据

**验证机制**:
- 检查是否选择了新区域 (不在现有区域中)
- 验证档位数据有效性
- 确认对话框防止误操作

#### 6.3 删除投放区域
**删除界面**:
- 复选框组显示所有现有区域
- 多选支持批量删除
- 实时提示选择状态

**安全机制**:
- 至少保留一个投放区域 (业务规则)
- 删除前确认对话框
- 显示删除后剩余区域信息

### 7. 数据联动与状态管理

#### 7.1 组件通信机制
**Home.vue 作为数据中心**:
- 管理全局搜索参数
- 协调组件间数据传递
- 处理所有业务事件

**通信流程**:
```
SearchForm → (search) → Home → (searchParams) → DataTable
DataTable → (row-selected) → Home → (selectedRecord) → SearchForm
SearchForm → (position-updated) → Home → (refresh) → DataTable
```

#### 7.2 状态同步机制
**自动同步功能**:
- 选中记录时自动填充表单
- 修改档位后自动刷新表格
- 新增/删除区域后保持选中状态
- 查询结果单条时自动选中

**数据一致性**:
- 确保界面数据与后端同步
- 操作成功后及时更新显示
- 错误处理与用户反馈

### 8. 用户交互体验

#### 8.1 智能提示系统
**输入提示**:
- 卷烟名称输入框：日期未完整时禁用并提示
- 档位约束提示：实时验证数值有效性
- 必填字段提示：缺少必要参数时的警告

**操作反馈**:
- 成功操作：绿色成功消息
- 警告提示：黄色警告消息  
- 错误信息：红色错误消息
- 加载状态：按钮loading状态

#### 8.2 界面响应性
**加载状态管理**:
- 数据查询时表格loading
- 档位保存时按钮loading
- 文件导入时对话框loading
- Excel导出时按钮loading

**操作确认机制**:
- 删除操作前确认对话框
- 新增区域前确认对话框
- 重要操作的二次确认

#### 8.3 错误处理
**错误类型处理**:
- 网络错误：连接超时提示
- 参数错误：具体字段验证提示
- 业务错误：后端返回的业务错误信息
- 文件错误：格式、大小限制提示

**用户引导**:
- 操作顺序提示
- 必要条件检查
- 友好的错误解释

---

## 🎯 技术特点

### 1. 现代化技术栈
- **Vue 3 Composition API**: 更好的组件逻辑复用
- **Element Plus**: 现代化UI组件库
- **Axios**: 专业的HTTP客户端
- **XLSX**: 强大的Excel处理能力

### 2. 响应式设计
- **弹性布局**: Flexbox布局适配不同屏幕
- **组件化架构**: 高度模块化的组件设计
- **状态管理**: 清晰的数据流向和状态同步

### 3. 用户体验优化
- **智能交互**: 自动填充、联动更新
- **操作反馈**: 完整的loading和消息提示
- **错误处理**: 友好的错误提示和引导

### 4. 数据处理能力
- **大数据支持**: 30档位 × 多记录的数据展示
- **Excel集成**: 完整的导入导出功能
- **实时计算**: 档位数据的实时验证和处理

---

## 📊 系统数据流

### 1. 查询流程
```
用户输入查询条件 → 验证必填参数 → 发送API请求 → 处理响应数据 → 表格展示 → 自动选中(单条)
```

### 2. 档位更新流程
```
选中卷烟记录 → 加载档位数据 → 用户修改档位 → 验证数据有效性 → 发送更新请求 → 刷新表格数据
```

### 3. 数据导入流程
```
选择文件和参数 → 验证文件格式 → 上传FormData → 后端处理 → 返回导入结果 → 刷新数据显示
```

### 4. 方案生成流程
```
选择时间参数 → 调用生成接口 → 后端算法处理 → 返回统计信息 → 显示结果弹窗 → 自动刷新数据
```

---
