# 卷烟分配服务API接口文档

## 目录
- [服务配置](#服务配置)
- [通用说明](#通用说明)
- [接口列表](#接口列表)
- [详细接口说明](#详细接口说明)
- [错误码说明](#错误码说明)
- [示例代码](#示例代码)

## 服务配置

### 基础信息
- **服务名称**: 卷烟分配服务
- **服务地址**: `http://localhost:28080`
- **API前缀**: `/api/cigarette`
- **完整基础URL**: `http://localhost:28080/api/cigarette`

### 请求配置
- **Content-Type**: `application/json`
- **字符编码**: `UTF-8`
- **跨域支持**: 已启用 (`@CrossOrigin`)

### 响应格式
所有接口都返回JSON格式数据，包含以下通用字段：
```json
{
  "success": true/false,
  "message": "操作结果描述",
  "data": {}, // 具体数据（可选）
  "error": "错误信息" // 仅在失败时返回
}
```

## 通用说明

### 数据格式
- **日期格式**: 年份、月份、周序号均为整数
- **金额格式**: 使用BigDecimal，支持小数点后2位
- **档位说明**: D30~D1表示30个档位，D30为最高档位，D1为最低档位

### 投放区域格式
- 多个区域用逗号分隔：`"镇中心区,镇乡结合区,特殊区域"`
- 支持中文区域名称
- 系统会自动去除首尾空格

## 接口列表

| 序号 | 接口名称 | 请求方式 | 接口地址 | 功能描述 |
|------|----------|----------|----------|----------|
| 1 | 健康检查 | GET | `/health` | 检查服务运行状态 |
| 2 | 查询卷烟分配 | POST | `/query` | 根据时间查询卷烟分配数据 |
| 3 | 查询原始数据 | POST | `/query-raw` | 查询未合并的原始数据 |
| 4 | 更新卷烟分配 | POST | `/update` | 更新指定卷烟的分配方案 |
| 5 | 卷烟信息更新 | POST | `/update-cigarette` | 更新卷烟完整信息（包括投放方式等） |
| 6 | 写回分配矩阵 | POST | `/write-back` | 将算法结果写回数据库 |
| 7 | 测试分配算法 | GET | `/test-algorithm` | 测试分配算法功能 |

## 详细接口说明

### 1. 健康检查

**接口地址**: `GET /health`

**功能描述**: 检查服务运行状态

**请求参数**: 无

**响应示例**:
```json
{
  "message": "卷烟分配服务运行正常",
  "status": "UP",
  "timestamp": 1756963797061
}
```

---

### 2. 查询卷烟分配

**接口地址**: `POST /query`

**功能描述**: 根据年份、月份、周序号查询卷烟分配数据，自动合并相同分配方案的记录

**请求参数示例**:
```json
{
  "year": 2024,
  "month": 1,
  "weekSeq": 1
}
```

**参数说明**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| year | Integer | 是 | 年份，如：2024 |
| month | Integer | 是 | 月份，1-12 |
| weekSeq | Integer | 是 | 周序号，1-5 |

**响应示例**:
```json
{
    "originalTotal": 8,
    "total": 5,
    "data": [
        {
            "d30": 2.00,
            "d10": 2.00,
            "d12": 2.00,
            "year": 2024,
            "d11": 2.00,
            "d14": 2.00,
            "d13": 2.00,
            "d16": 2.00,
            "advAmount": 15793.00,
            "mergedCount": 4,
            "d15": 2.00,
            "remark": "算法自动生成",
            "d18": 2.00,
            "d17": 2.00,
            "d19": 2.00,
            "d1": 1.00,
            "d2": 1.00,
            "cigCode": "42010114",
            "d3": 1.00,
            "d4": 1.00,
            "d5": 1.00,
            "d6": 1.00,
            "d7": 1.00,
            "d8": 2.00,
            "d9": 2.00,
            "d21": 2.00,
            "d20": 2.00,
            "d23": 2.00,
            "d22": 2.00,
            "d25": 2.00,
            "d24": 2.00,
            "d27": 2.00,
            "d26": 2.00,
            "cigName": "红金龙(硬爱你爆珠)",
            "d29": 2.00,
            "weekSeq": 1,
            "d28": 2.00,
            "month": 1,
            "deliveryAreas": "乡中心区,村庄,镇中心区,镇乡结合区",
            "actualDelivery": 15612.0000
        },
        {
            "d30": 3.00,
            "d10": 0.00,
            "d12": 0.00,
            "year": 2024,
            "d11": 0.00,
            "d14": 0.00,
            "d13": 0.00,
            "d16": 1.00,
            "advAmount": 2683.00,
            "mergedCount": 1,
            "d15": 0.00,
            "remark": "算法自动生成",
            "d18": 1.00,
            "d17": 1.00,
            "d19": 1.00,
            "d1": 0.00,
            "d2": 0.00,
            "cigCode": "35300080",
            "d3": 0.00,
            "d4": 0.00,
            "d5": 0.00,
            "d6": 0.00,
            "d7": 0.00,
            "d8": 0.00,
            "d9": 0.00,
            "d21": 1.00,
            "d20": 1.00,
            "d23": 1.00,
            "d22": 1.00,
            "d25": 1.00,
            "d24": 1.00,
            "d27": 1.00,
            "d26": 1.00,
            "cigName": "七匹狼(纯境)",
            "d29": 2.00,
            "weekSeq": 1,
            "d28": 1.00,
            "month": 1,
            "deliveryAreas": "镇中心区",
            "actualDelivery": 2683.0000
        },
        {
            "d30": 2.00,
            "d10": 0.00,
            "d12": 0.00,
            "year": 2024,
            "d11": 0.00,
            "d14": 0.00,
            "d13": 0.00,
            "d16": 1.00,
            "advAmount": 2683.00,
            "mergedCount": 1,
            "d15": 0.00,
            "remark": "算法自动生成",
            "d18": 1.00,
            "d17": 1.00,
            "d19": 1.00,
            "d1": 0.00,
            "d2": 0.00,
            "cigCode": "35300080",
            "d3": 0.00,
            "d4": 0.00,
            "d5": 0.00,
            "d6": 0.00,
            "d7": 0.00,
            "d8": 0.00,
            "d9": 0.00,
            "d21": 1.00,
            "d20": 1.00,
            "d23": 1.00,
            "d22": 1.00,
            "d25": 1.00,
            "d24": 1.00,
            "d27": 1.00,
            "d26": 1.00,
            "cigName": "七匹狼(纯境)",
            "d29": 2.00,
            "weekSeq": 1,
            "d28": 1.00,
            "month": 1,
            "deliveryAreas": "镇乡结合区",
            "actualDelivery": 2683.0000
        },
        {
            "d30": 3.00,
            "d10": 0.00,
            "d12": 0.00,
            "year": 2024,
            "d11": 0.00,
            "d14": 0.00,
            "d13": 0.00,
            "d16": 1.00,
            "advAmount": 2683.00,
            "mergedCount": 1,
            "d15": 0.00,
            "remark": "算法自动生成",
            "d18": 1.00,
            "d17": 1.00,
            "d19": 1.00,
            "d1": 0.00,
            "d2": 0.00,
            "cigCode": "35300080",
            "d3": 0.00,
            "d4": 0.00,
            "d5": 0.00,
            "d6": 0.00,
            "d7": 0.00,
            "d8": 0.00,
            "d9": 0.00,
            "d21": 1.00,
            "d20": 1.00,
            "d23": 1.00,
            "d22": 1.00,
            "d25": 1.00,
            "d24": 1.00,
            "d27": 1.00,
            "d26": 1.00,
            "cigName": "七匹狼(纯境)",
            "d29": 3.00,
            "weekSeq": 1,
            "d28": 1.00,
            "month": 1,
            "deliveryAreas": "城乡结合区",
            "actualDelivery": 2683.0000
        },
        {
            "d30": 2.00,
            "d10": 2.00,
            "d12": 2.00,
            "year": 2024,
            "d11": 2.00,
            "d14": 2.00,
            "d13": 2.00,
            "d16": 2.00,
            "advAmount": 15793.00,
            "mergedCount": 1,
            "d15": 2.00,
            "remark": "算法自动生成",
            "d18": 2.00,
            "d17": 2.00,
            "d19": 2.00,
            "d1": 1.00,
            "d2": 1.00,
            "cigCode": "42010114",
            "d3": 1.00,
            "d4": 1.00,
            "d5": 2.00,
            "d6": 2.00,
            "d7": 2.00,
            "d8": 2.00,
            "d9": 2.00,
            "d21": 2.00,
            "d20": 2.00,
            "d23": 2.00,
            "d22": 2.00,
            "d25": 2.00,
            "d24": 2.00,
            "d27": 2.00,
            "d26": 2.00,
            "cigName": "红金龙(硬爱你爆珠)",
            "d29": 2.00,
            "weekSeq": 1,
            "d28": 2.00,
            "month": 1,
            "deliveryAreas": "特殊区域",
            "actualDelivery": 15612.0000
        }
    ],
    "success": true,
    "message": "查询成功"
}
```

**响应字段说明**:
| 字段名 | 类型 | 说明 |
|--------|------|------|
| success | Boolean | 操作是否成功 |
| message | String | 操作结果描述 |
| originalTotal | Integer | 原始记录总数 |
| total | Integer | 合并后记录总数 |
| data | Array | 卷烟分配数据数组 |
| cigCode | String | 卷烟代码 |
| cigName | String | 卷烟名称 |
| deliveryMethod | String | 投放方式 |
| deliveryEtype | String | 扩展投放方式 |
| advAmount | BigDecimal | 预投放量 |
| actualDelivery | BigDecimal | 实际投放量 |
| d30~d1 | BigDecimal | 30个档位的分配值 |
| deliveryAreas | String | 投放区域（逗号分隔） |
| remark | String | 备注 |
| mergedCount | Integer | 合并的记录数量 |

---

### 3. 查询原始数据

**接口地址**: `POST /query-raw`

**功能描述**: 查询未合并的原始数据，用于调试和验证

**请求参数**: 同查询卷烟分配接口

**响应格式**: 返回原始的数据库记录，不进行合并处理


### 4. 卷烟信息更新 ⭐ **推荐使用**

**接口地址**: `POST /update-cigarette`

**功能描述**: 更新卷烟的完整信息，包括投放方式、扩展投放方式、投放区域、档位分配、备注等

**请求参数示例**:
```json
{
  "cigCode": "42010114",
  "cigName": "红金龙(硬爱你爆珠)",
  "year": 2024,
  "month": 1,
  "weekSeq": 1,
  "deliveryMethod": "按档位扩展投放",
  "deliveryEtype": "档位+城乡分类代码",
  "deliveryArea": "特殊区域",
  "distribution": [2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 1.0, 1.0, 1.0, 1.0, 1.0],
  "remark": "测试更新"
}
```

**参数说明**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| cigCode | String | 是 | 卷烟代码 |
| cigName | String | 是 | 卷烟名称 |
| year | Integer | 是 | 年份 |
| month | Integer | 是 | 月份 |
| weekSeq | Integer | 是 | 周序号 |
| deliveryMethod | String | 是 | 投放方式 |
| deliveryEtype | String | 是 | 扩展投放方式 |
| deliveryArea | String | 是 | 投放区域（逗号分隔） |
| distribution | Array | 是 | 30个档位的分配值，按D30~D1顺序 |
| remark | String | 否 | 备注信息 |

