# æ•°æ®å­˜å‚¨è¯´æ˜

> **é‡è¦**: æœ¬æ–‡æ¡£è¯´æ˜æ•°æ®åº“å’Œæ—¥å¿—çš„å®é™…å­˜å‚¨ä½ç½®

---

## ğŸ“‚ éƒ¨ç½²åŒ…ä¸­çš„ç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ mysql/
â”‚   â”œâ”€â”€ init/              # åˆå§‹åŒ–SQLæ–‡ä»¶ï¼ˆä¼šå¤åˆ¶åˆ°æœåŠ¡å™¨ï¼‰
â”‚   â”‚   â””â”€â”€ init.sql       # 18KB - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ docker-compose.yml # MySQLæœåŠ¡é…ç½®
â”‚
â”œâ”€â”€ Springboot-server/     # åç«¯åº”ç”¨
â””â”€â”€ vue-web/               # å‰ç«¯åº”ç”¨
```

**æ³¨æ„**: éƒ¨ç½²åŒ…ä¸­**æ²¡æœ‰**æ•°æ®å­˜å‚¨ç›®å½•ï¼Œæ‰€æœ‰æ•°æ®éƒ½å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸Šã€‚

---

## ğŸ’¾ æœåŠ¡å™¨ä¸Šçš„æ•°æ®å­˜å‚¨ä½ç½®

éƒ¨ç½²åï¼Œæ•°æ®ä¼šå­˜å‚¨åœ¨æœåŠ¡å™¨çš„ä»¥ä¸‹ç›®å½•ï¼š

### 1. æ•°æ®åº“æ•°æ®

**è·¯å¾„**: `/data/mysql/data/`

**å†…å®¹**:
- MySQLæ‰€æœ‰æ•°æ®åº“æ–‡ä»¶
- åŒ…æ‹¬ `marketing` æ•°æ®åº“çš„æ‰€æœ‰è¡¨æ•°æ®
- ç³»ç»Ÿæ•°æ®åº“ï¼ˆmysql, performance_schemaç­‰ï¼‰

**å¤§å°**: éšç€ä½¿ç”¨é€æ¸å¢é•¿

**æŒ‚è½½é…ç½®** (docker-compose.yml):
```yaml
volumes:
  - /data/mysql/data:/var/lib/mysql
```

**âš ï¸ é‡è¦**:
- åˆ é™¤æ­¤ç›®å½•ä¼š**ä¸¢å¤±æ‰€æœ‰æ•°æ®åº“æ•°æ®**ï¼
- å¿…é¡»å®šæœŸå¤‡ä»½æ­¤ç›®å½•

---

### 2. æ•°æ®åº“é…ç½®

**è·¯å¾„**: `/data/mysql/conf/`

**ç”¨é€”**: å­˜æ”¾è‡ªå®šä¹‰MySQLé…ç½®æ–‡ä»¶ï¼ˆå¦‚my.cnfï¼‰

**æŒ‚è½½é…ç½®**:
```yaml
volumes:
  - /data/mysql/conf:/etc/mysql/conf.d
```

---

### 3. æ•°æ®åº“åˆå§‹åŒ–SQL

**è·¯å¾„**: `/data/mysql/init/`

**å†…å®¹**: 
- `init.sql` - ä»éƒ¨ç½²åŒ…ä¸­å¤åˆ¶è¿‡æ¥
- é¦–æ¬¡å¯åŠ¨æ—¶MySQLä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤ç›®å½•ä¸‹çš„SQLæ–‡ä»¶

**æŒ‚è½½é…ç½®**:
```yaml
volumes:
  - /data/mysql/init:/docker-entrypoint-initdb.d
```

**æ³¨æ„**: 
- ä»…åœ¨é¦–æ¬¡å¯åŠ¨æ—¶æ‰§è¡Œ
- å¦‚æœ `/data/mysql/data/` å·²æœ‰æ•°æ®ï¼Œåˆå§‹åŒ–SQLä¸ä¼šé‡å¤æ‰§è¡Œ

---

### 4. åç«¯æ—¥å¿—

**è·¯å¾„**: `/data/springboot/logs/`

**å†…å®¹**:
- `application.log` - Spring Bootåº”ç”¨æ—¥å¿—
- è‡ªåŠ¨è½®è½¬ï¼ˆæœ€å¤§100MBï¼Œä¿ç•™30å¤©ï¼‰

**æŒ‚è½½é…ç½®**:
```yaml
volumes:
  - /data/springboot/logs:/app/logs:rw
```

---

### 5. å‰ç«¯æ—¥å¿—

**è·¯å¾„**: `/data/vue-web/logs/`

**å†…å®¹**:
- `access.log` - Nginxè®¿é—®æ—¥å¿—
- `error.log` - Nginxé”™è¯¯æ—¥å¿—

**æŒ‚è½½é…ç½®**:
```yaml
volumes:
  - /data/vue-web/logs:/usr/local/openresty/nginx/logs:rw
```

---

## ğŸ”„ æ•°æ®æµç¨‹

### éƒ¨ç½²æ—¶

```
1. ä¸Šä¼ éƒ¨ç½²åŒ…åˆ°æœåŠ¡å™¨ (çº¦77MB)
   â””â”€ åŒ…å«: å‰ç«¯dist, åç«¯jar, é…ç½®æ–‡ä»¶, init.sql

2. è¿è¡Œ deploy.sh
   â”œâ”€ åˆ›å»ºæœåŠ¡å™¨ç›®å½•:
   â”‚  â”œâ”€ /data/mysql/data/     â† ç©ºç›®å½•
   â”‚  â”œâ”€ /data/mysql/conf/     â† ç©ºç›®å½•
   â”‚  â”œâ”€ /data/mysql/init/     â† å¤åˆ¶init.sqlåˆ°æ­¤
   â”‚  â”œâ”€ /data/springboot/logs/ â† ç©ºç›®å½•
   â”‚  â””â”€ /data/vue-web/logs/   â† ç©ºç›®å½•
   â”‚
   â””â”€ å¯åŠ¨Dockerå®¹å™¨
      â””â”€ MySQLé¦–æ¬¡å¯åŠ¨
         â””â”€ æ‰§è¡Œ /data/mysql/init/init.sql
         â””â”€ åœ¨ /data/mysql/data/ åˆ›å»ºæ•°æ®åº“æ–‡ä»¶
```

### è¿è¡Œæ—¶

```
ç”¨æˆ·è®¿é—® â†’ Nginx â†’ Spring Boot â†’ MySQL
                                   â†“
                            è¯»å†™ /data/mysql/data/
                            
Spring Boot æ—¥å¿— â†’ /data/springboot/logs/
Nginx æ—¥å¿— â†’ /data/vue-web/logs/
```

---

## ğŸ“Š æ•°æ®ç›®å½•å¤§å°é¢„ä¼°

| ç›®å½• | åˆå§‹å¤§å° | å¢é•¿é€Ÿåº¦ | å»ºè®®æ¸…ç† |
|-----|---------|---------|---------|
| `/data/mysql/data/` | ~200MB | ä¸­ç­‰ | âŒ ä¸è¦åˆ é™¤ |
| `/data/mysql/init/` | 18KB | ä¸å¢é•¿ | âœ… å¯ä¿ç•™ |
| `/data/springboot/logs/` | 0 | è¾ƒå¿« | âœ… è‡ªåŠ¨è½®è½¬ |
| `/data/vue-web/logs/` | 0 | è¾ƒå¿« | âš ï¸ éœ€å®šæœŸæ¸…ç† |

---

## ğŸ”’ æ•°æ®å¤‡ä»½å»ºè®®

### 1. æ•°æ®åº“å¤‡ä»½ï¼ˆæœ€é‡è¦ï¼‰

```bash
# æ¯å¤©è‡ªåŠ¨å¤‡ä»½
docker exec mysql mysqldump -usyyc -p'syyc@12AB' --all-databases > /root/backup/mysql_$(date +%Y%m%d).sql
```

**å¤‡ä»½å†…å®¹**: æ‰€æœ‰æ•°æ®åº“æ•°æ®  
**é¢‘ç‡**: æ¯å¤©  
**ä¿ç•™**: è‡³å°‘7å¤©  

### 2. é…ç½®æ–‡ä»¶å¤‡ä»½

```bash
# å¤‡ä»½éƒ¨ç½²åŒ…ï¼ˆåŒ…å«æ‰€æœ‰é…ç½®ï¼‰
tar -czf /root/backup/config_$(date +%Y%m%d).tar.gz /root/cigarette-system/data/
```

**å¤‡ä»½å†…å®¹**: æ‰€æœ‰é…ç½®æ–‡ä»¶  
**é¢‘ç‡**: æ¯æ¬¡ä¿®æ”¹å  

---

## ğŸ—‘ï¸ æ•°æ®æ¸…ç†

### å®‰å…¨æ¸…ç†ï¼ˆæ—¥å¿—ï¼‰

```bash
# æ¸…ç†30å¤©å‰çš„åç«¯æ—¥å¿—ï¼ˆå¦‚æœæ²¡æœ‰è‡ªåŠ¨è½®è½¬ï¼‰
find /data/springboot/logs/ -name "*.log.*" -mtime +30 -delete

# æ¸…ç†Nginxæ—¥å¿—ï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰
find /data/vue-web/logs/ -name "*.log" -mtime +7 -delete
```

### å±é™©æ“ä½œï¼ˆæ•°æ®åº“ï¼‰

```bash
# âš ï¸ åˆ é™¤æ‰€æœ‰æ•°æ®åº“æ•°æ®ï¼ˆå±é™©ï¼ï¼‰
docker compose down
rm -rf /data/mysql/data/*
./deploy.sh  # é‡æ–°åˆå§‹åŒ–
```

**è­¦å‘Š**: è¿™ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®åº“æ•°æ®ï¼ä»…åœ¨éœ€è¦å®Œå…¨é‡ç½®æ—¶ä½¿ç”¨ã€‚

---

## ğŸ“ å®Œæ•´çš„æœåŠ¡å™¨ç›®å½•ç»“æ„

éƒ¨ç½²æˆåŠŸåï¼ŒæœåŠ¡å™¨ä¸Šçš„å®Œæ•´ç›®å½•ç»“æ„ï¼š

```
/root/cigarette-system/
â””â”€â”€ data/                           # éƒ¨ç½²åŒ…
    â”œâ”€â”€ vue-web/
    â”œâ”€â”€ Springboot-server/
    â”œâ”€â”€ mysql/
    â”œâ”€â”€ docker-compose.yml
    â””â”€â”€ deploy.sh

/data/                              # æ•°æ®å­˜å‚¨ï¼ˆæŒä¹…åŒ–ï¼‰
â”œâ”€â”€ mysql/
â”‚   â”œâ”€â”€ data/                      # âš ï¸ æ•°æ®åº“æ•°æ®ï¼ˆé‡è¦ï¼ï¼‰
â”‚   â”œâ”€â”€ conf/                      # MySQLé…ç½®
â”‚   â””â”€â”€ init/                      # åˆå§‹åŒ–SQL
â”œâ”€â”€ springboot/
â”‚   â””â”€â”€ logs/                      # åç«¯æ—¥å¿—
â””â”€â”€ vue-web/
    â””â”€â”€ logs/                      # å‰ç«¯æ—¥å¿—
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆéƒ¨ç½²åŒ…ä¸­æ²¡æœ‰dataç›®å½•ï¼Ÿ

**A**: æ•°æ®ç›®å½•æ˜¯åœ¨æœåŠ¡å™¨ä¸ŠåŠ¨æ€åˆ›å»ºçš„ï¼Œä¸éœ€è¦åœ¨éƒ¨ç½²åŒ…ä¸­æºå¸¦ã€‚è¿™æ ·å¯ä»¥ï¼š
- å‡å°éƒ¨ç½²åŒ…å¤§å°
- é¿å…æœ¬åœ°æµ‹è¯•æ•°æ®è¢«ä¸Šä¼ 
- ä¿æŒéƒ¨ç½²åŒ…çš„çº¯å‡€

### Q2: å¦‚ä½•æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶å¤§å°ï¼Ÿ

```bash
du -sh /data/mysql/data/
```

### Q3: å¦‚ä½•è¿ç§»æ•°æ®åˆ°æ–°æœåŠ¡å™¨ï¼Ÿ

```bash
# åœ¨æ—§æœåŠ¡å™¨ä¸Šå¤‡ä»½
docker exec mysql mysqldump -usyyc -p'syyc@12AB' --all-databases > backup.sql

# åœ¨æ–°æœåŠ¡å™¨ä¸Šæ¢å¤
docker exec -i mysql mysql -usyyc -p'syyc@12AB' < backup.sql
```

### Q4: æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ

åªè¦ `/data/mysql/data/` ç›®å½•å­˜åœ¨ä¸”æœªè¢«åˆ é™¤ï¼Œæ•°æ®å°±ä¸ä¼šä¸¢å¤±ã€‚å³ä½¿ï¼š
- é‡å¯æœåŠ¡å™¨ âœ… æ•°æ®ä¿ç•™
- é‡å¯å®¹å™¨ âœ… æ•°æ®ä¿ç•™  
- é‡æ–°éƒ¨ç½² âœ… æ•°æ®ä¿ç•™ï¼ˆé™¤éåˆ é™¤dataç›®å½•ï¼‰

---

**æ›´æ–°æ—¶é—´**: 2025-10-24

